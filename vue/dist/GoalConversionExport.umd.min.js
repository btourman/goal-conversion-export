(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):"function"===typeof define&&define.amd?define(["CoreHome",,"CorePluginsAdmin"],t):"object"===typeof exports?exports["GoalConversionExport"]=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):e["GoalConversionExport"]=t(e["CoreHome"],e["Vue"],e["CorePluginsAdmin"])})("undefined"!==typeof self?self:this,(function(e,t,o){return function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="plugins/GoalConversionExport/vue/dist/",o(o.s="fae3")}({"19dc":function(t,o){t.exports=e},"8bbf":function(e,o){e.exports=t},a5a2:function(e,t){e.exports=o},fae3:function(e,t,o){"use strict";if(o.r(t),o.d(t,"GoalConversionEdit",(function(){return T})),o.d(t,"GoalConversionList",(function(){return me})),"undefined"!==typeof window){var n=window.document.currentScript,r=n&&n.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);r&&(o.p=r[1])}var i=o("19dc"),a=o("8bbf"),l={class:"row"},c={class:"col s12"},s={class:"row"},u={class:"col s12"},d={class:"row"},p={class:"col s12"},m={class:"row"},v={class:"col s12"},f={class:"row"},x={class:"col s12"},b={key:0,class:"row"},h={class:"col s12"},E={key:1,class:"row"},y={class:"col s12"},j={class:"row",style:{"margin-bottom":"0"}},O={class:Object(a["normalizeClass"])("col s12")},g=Object(a["createElementVNode"])("h3",null,"Conversions To Export",-1),C=Object(a["createElementVNode"])("p",null,[Object(a["createTextVNode"])("In this section, you can specify the objectives to be included in the exported conversions. For each objective, you have the option to designate an alternative name for use in the export. This alternative name is employed to link Matomo objectives to the conversions configured in an external system, such as Google Ads. You can also assign the same alternative name to multiple objectives to consolidate them into a single conversion alias. "),Object(a["createElementVNode"])("br"),Object(a["createTextVNode"])("Furthermore, you have the flexibility to set the revenue to be utilized for the export.")],-1);function V(e,t,o,n,r,i){var V=this,N=Object(a["resolveComponent"])("Field"),k=Object(a["resolveComponent"])("SaveButton"),w=Object(a["resolveComponent"])("ContentBlock");return Object(a["openBlock"])(),Object(a["createBlock"])(w,null,{default:Object(a["withCtx"])((function(){return[Object(a["createElementVNode"])("div",l,[Object(a["createElementVNode"])("div",c,[Object(a["createVNode"])(N,{"model-value":e.conversionExport.name,"inline-help":"Provide a concise label to distinguish this export conversion in the list\n          of exports.",name:"name",title:"Name of export",uicontrol:"text","onUpdate:modelValue":t[0]||(t[0]=function(t){return e.conversionExport.name=t})},null,8,["model-value"])])]),Object(a["createElementVNode"])("div",s,[Object(a["createElementVNode"])("div",u,[Object(a["createVNode"])(N,{"model-value":e.conversionExport.export_type,options:e.exportTypeOptions,"inline-help":"Select the Export category. Depending on your choice, the export format\n          may vary. You have the option to choose from these categories:",name:"type",title:"Export type",uicontrol:"radio","onUpdate:modelValue":t[1]||(t[1]=function(t){return e.conversionExport.export_type=t})},null,8,["model-value","options"])])]),Object(a["createElementVNode"])("div",d,[Object(a["createElementVNode"])("div",p,[Object(a["createVNode"])(N,{"model-value":e.conversionExport.description,"inline-help":"Providing a description could be useful for providing additional details\n          about the export conversion and its intended purpose.",name:"description",title:"Description (Optional)",uicontrol:"text","onUpdate:modelValue":t[2]||(t[2]=function(t){return e.conversionExport.description=t})},null,8,["model-value"])])]),Object(a["createElementVNode"])("div",m,[Object(a["createElementVNode"])("div",v,[Object(a["createVNode"])(N,{"model-value":e.conversionExport.access_token,disabled:"","inline-help":"The access token generated within the export URL provides unique access to\n          export conversions to third-party external services and tools.",name:"access_token",placeholder:"Access token will be automatically generated after the export is created.",title:"Access Token",uicontrol:"text"},null,8,["model-value"])])]),Object(a["createElementVNode"])("div",f,[Object(a["createElementVNode"])("div",x,[Object(a["createVNode"])(N,{"model-value":e.conversionExport.day_to_export,"inline-help":"You can specify the count of days to be incorporated into the export,\n          with today always being excluded.",name:"day_to_export",title:"Days to export",uicontrol:"number","onUpdate:modelValue":t[3]||(t[3]=function(t){return e.conversionExport.day_to_export=t})},null,8,["model-value"])])]),"facebook"==e.conversionExport.export_type?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",b,[Object(a["createElementVNode"])("div",h,[Object(a["createVNode"])(N,{"model-value":e.conversionExport.parameters.pixel_id,"inline-help":"Here you must define the meta pixel ID",name:"pixel_id",title:"Pixel ID",uicontrol:"text","onUpdate:modelValue":t[4]||(t[4]=function(t){return e.conversionExport.parameters.pixel_id=t})},null,8,["model-value"])])])):Object(a["createCommentVNode"])("",!0),"facebook"==e.conversionExport.export_type?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",E,[Object(a["createElementVNode"])("div",y,[Object(a["createVNode"])(N,{"model-value":e.conversionExport.parameters.meta_access_token,"inline-help":"Here you must define the Meta Access Token to send to Conversion API",name:"meta_access_token",title:"Meta Access Token",uicontrol:"text","onUpdate:modelValue":t[5]||(t[5]=function(t){return e.conversionExport.parameters.meta_access_token=t})},null,8,["model-value"])])])):Object(a["createCommentVNode"])("",!0),Object(a["createElementVNode"])("div",j,[Object(a["createElementVNode"])("div",O,[g,C,Object(a["createVNode"])(N,{"model-value":e.conversionExport.goals,"ui-control-attributes":{field1:{key:"id_goal",title:"Goal",uiControl:"select",availableValues:V.goals},field2:{key:"export_name",title:"Alias name in export",uiControl:"text"},field3:{key:"revenu",title:"Revenue",uiControl:"select",availableValues:V.revenueOptions}},"full-width":"true",name:"trigger_type",uicontrol:"multituple","onUpdate:modelValue":t[6]||(t[6]=function(t){return e.conversionExport.goals=t})},null,8,["model-value","ui-control-attributes"])])]),Object(a["createVNode"])(k,{class:"createButton",tabindex:"100",onConfirm:t[7]||(t[7]=function(t){return e.save()})})]})),_:1})}var N=o("a5a2"),k=function(){return i["AjaxHelper"].fetch({module:"API",method:"Goals.getGoals",idSite:i["Matomo"].idSite,filter_limit:"-1"}).then((function(e){return Object.values(e).reduce((function(e,t){return e[t.idgoal]=t.name,e}),{})}))},w=function(){return i["AjaxHelper"].fetch({module:"API",method:"GoalConversionExport.getGoalConversions",idSite:i["Matomo"].idSite,filter_limit:"-1"}).then((function(e){return e.map((function(e){return"string"===typeof e.goals&&(e.goals=JSON.parse(e.goals)),e}))}))},_=function(e){return i["AjaxHelper"].fetch({module:"API",method:"GoalConversionExport.getGoalConversion",idSite:i["Matomo"].idSite,idExport:e,filter_limit:"-1"}).then((function(e){return"string"===typeof e.goals&&(e.goals=JSON.parse(e.goals)),"string"===typeof e.parameters&&"null"!==e.parameters?e.parameters=JSON.parse(e.parameters):e.parameters={},e}))},S=function(e){return i["AjaxHelper"].post({},{idExport:e,idSite:i["Matomo"].idSite,method:"GoalConversionExport.deleteGoalConversion"},{withTokenInUrl:!0}).then((function(e){return{type:"success",response:e}})).catch((function(e){return{type:"error",message:e.message||e}}))},B={goal:"Include revenue information in the export (if any available)",null:"Do not set revenue (revenue won't be exported)"},A={google:"Google",facebook:"Facebook"},G=Object(a["defineComponent"])({components:{ContentBlock:i["ContentBlock"],Field:N["Field"],SaveButton:N["SaveButton"]},data:function(){return{goals:{},conversionExport:{export_type:"google",day_to_export:7,goals:[{id_goal:"",export_name:"",revenu:""}],parameters:{pixel_id:"",meta_access_token:""}}}},mounted:function(){var e=this;k().then((function(t){e.goals=t}));var t=new URLSearchParams(window.location.search);t.has("idExport")&&_(t.get("idExport")).then((function(t){e.conversionExport=t}))},methods:{constructBodySave:function(){var e={name:this.conversionExport.name,exportType:this.conversionExport.export_type,description:this.conversionExport.description?this.conversionExport.description.trim():"",method:"GoalConversionExport.addGoalConversion",goals:this.conversionExport.goals.filter((function(e){return!!e.id_goal&&!!e.revenu})),dayToExport:this.conversionExport.day_to_export,idExport:null,parameters:{}};return this.conversionExport.id_export&&(e.idExport=this.conversionExport.id_export,e.method="GoalConversionExport.updateGoalConversion"),"facebook"===this.conversionExport.export_type&&(e.parameters=this.conversionExport.parameters),e},save:function(){return i["AjaxHelper"].post({},this.constructBodySave(),{withTokenInUrl:!0}).then((function(){window.location.href="".concat(window.location.origin).concat(window.location.pathname,"?module=GoalConversionExport&action=index&idSite=").concat(i["Matomo"].idSite)})).catch((function(e){return{type:"error",message:e.message||e}}))}},computed:{exportTypeOptions:function(){return A},revenueOptions:function(){return B}}});G.render=V;var T=G,U=(Object(i["createAngularJsAdapter"])({component:T,scope:{exportTypes:{angularJsBind:"="},alreadyCreatedExportTypes:{angularJsBind:"="},clickIdProviders:{angularJsBind:"="},hasWriteAccess:{angularJsBind:"="}},directiveName:"goalConversionExportEdit"}),{class:"alert alert-info"}),M=Object(a["createTextVNode"])(" Exports below are only available for "),P=Object(a["createTextVNode"])(" website. "),I={class:"card card-table entityTable"},L=Object(a["createElementVNode"])("thead",null,[Object(a["createElementVNode"])("tr",null,[Object(a["createElementVNode"])("th",null,"Name"),Object(a["createElementVNode"])("th",null,"Export type"),Object(a["createElementVNode"])("th",null,"Included Conversions"),Object(a["createElementVNode"])("th",null,"Last requested"),Object(a["createElementVNode"])("th",null,"Actions")])],-1),D=["id"],H=["id","innerHTML"],J={style:{display:"flex",gap:"15px","justify-content":"center","align-items":"center"}},q=["onClick"],F=["onClick"],R=["href"],$=["onClick"],Y={id:"confirmDeleteExport",ref:"confirmDeleteExport",class:"ui-confirm"},z=Object(a["createElementVNode"])("h2",null,"Are you sure you want to delete this export? External services using this export URL as data source will no longer be able to fetch any data.",-1),W=Object(a["createElementVNode"])("input",{role:"yes",type:"button",value:"Yes"},null,-1),K=Object(a["createElementVNode"])("input",{role:"no",type:"button",value:"No"},null,-1),Q=[z,W,K],X={id:"showExportLink",ref:"showExportLink",class:"ui-confirm"},Z=Object(a["createElementVNode"])("h2",null,"Link to download this conversion export",-1),ee=["value"],te=Object(a["createTextVNode"])(" Be careful with whom you share this, as it will grant access to this conversion export without any further authentication. "),oe=Object(a["createElementVNode"])("input",{role:"yes",type:"button",value:"Close"},null,-1);
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function ne(e,t,o,n,r,i){var l=Object(a["resolveComponent"])("SaveButton"),c=Object(a["resolveComponent"])("ContentBlock");return Object(a["openBlock"])(),Object(a["createBlock"])(c,null,{default:Object(a["withCtx"])((function(){return[Object(a["createElementVNode"])("div",U,[M,Object(a["createElementVNode"])("strong",null,Object(a["toDisplayString"])(e.site),1),P]),Object(a["createElementVNode"])("table",I,[L,Object(a["createElementVNode"])("tbody",null,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.goalConversions,(function(t){return Object(a["openBlock"])(),Object(a["createElementBlock"])("tr",{id:"export_".concat(t.id_export),key:t.id_export},[Object(a["createElementVNode"])("td",null,Object(a["toDisplayString"])(t.name),1),Object(a["createElementVNode"])("td",null,Object(a["toDisplayString"])(e.exportTypeOptions[t.export_type]),1),Object(a["createElementVNode"])("td",null,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(t.goals,(function(t){return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{id:"goal_".concat(t.id_export),key:t.id_export,innerHTML:e.$sanitize(e.displayGoal(t))},null,8,H)})),128))]),Object(a["createElementVNode"])("td",null,Object(a["toDisplayString"])(t.ts_requested),1),Object(a["createElementVNode"])("td",null,[Object(a["createElementVNode"])("div",J,[Object(a["createElementVNode"])("a",{class:"icon-download",href:"#",style:{"text-decoration":"none !important"},title:"Download",onClick:function(o){return e.openExport(t.access_token)}},null,8,q),Object(a["createElementVNode"])("a",{class:"icon-export",href:"#",style:{"text-decoration":"none !important"},title:"Export URL",onClick:function(o){return e.generateExportUrl(t.access_token)}},null,8,F),Object(a["createElementVNode"])("a",{href:e.editGoalConversion(t.id_export),class:"icon-edit",style:{"text-decoration":"none !important"},title:"Edit"},null,8,R),Object(a["createElementVNode"])("a",{class:"icon-delete",href:"#",style:{"text-decoration":"none !important"},title:"Delete",onClick:function(o){return e.deleteConversion(t.id_export)}},null,8,$)])])],8,D)})),128))])]),Object(a["createVNode"])(l,{class:"createButton",tabindex:"100",value:"Create new conversion export",onConfirm:t[0]||(t[0]=function(t){return e.save()})}),Object(a["createElementVNode"])("div",Y,Q,512),Object(a["createElementVNode"])("div",X,[Z,Object(a["createElementVNode"])("textarea",{id:"exportLink",value:e.exportLink,onclick:"this.select()",readonly:""},null,8,ee),te,oe],512)]})),_:1})}function re(e,t){return se(e)||ce(e,t)||ae(e,t)||ie()}function ie(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ae(e,t){if(e){if("string"===typeof e)return le(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?le(e,t):void 0}}function le(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}function ce(e,t){var o=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var n,r,i=[],a=!0,l=!1;try{for(o=o.call(e);!(a=(n=o.next()).done);a=!0)if(i.push(n.value),t&&i.length===t)break}catch(c){l=!0,r=c}finally{try{a||null==o["return"]||o["return"]()}finally{if(l)throw r}}return i}}function se(e){if(Array.isArray(e))return e}var ue={goal:"UseGoalRevenue",custom:"UseCustomRevenue",null:"UseEmptyRevenue"},de={google:"Google",facebook:"Facebook"},pe=Object(a["defineComponent"])({components:{ContentBlock:i["ContentBlock"],SaveButton:N["SaveButton"]},data:function(){return{site:i["Matomo"].currentSiteName,goals:{},goalConversions:[],exportLink:""}},mounted:function(){var e=this;Promise.all([k(),w()]).then((function(t){var o=re(t,2),n=o[0],r=o[1];e.goals=n,e.goalConversions=r.sort((function(e,t){return parseInt("".concat(e.id_export),10)-parseInt("".concat(t.id_export),10)}))}))},methods:{save:function(){window.location.href="".concat(window.location.origin).concat(window.location.pathname,"?module=GoalConversionExport&action=createOrEdit&idSite=").concat(i["Matomo"].idSite)},displayGoal:function(e){var t=[this.goals[e.id_goal]];t.push("&#x279C;"),t.push(e.export_name);var o=this.revenueOptions[e.revenu];return o&&t.push("(".concat(o,")")),t.join(" ")},openExport:function(e){window.open(this.getExportUrl(e))},getExportUrl:function(e){var t=i["MatomoUrl"].stringify({module:"GoalConversionExport",action:"generateConversionExport",accessToken:e});return"".concat(window.location.origin).concat(window.location.pathname,"?").concat(t)},generateExportUrl:function(e){this.exportLink=this.getExportUrl(e),i["Matomo"].helper.modalConfirm(this.$refs.showExportLink)},deleteConversion:function(e){var t=this;i["Matomo"].helper.modalConfirm(this.$refs.confirmDeleteExport,{yes:function(){S(e).then(w).then((function(e){t.goalConversions=e}))}})},editGoalConversion:function(e){return"".concat(window.location.origin).concat(window.location.pathname,"?module=GoalConversionExport&action=createOrEdit&idSite=").concat(i["Matomo"].idSite,"&idExport=").concat(e)}},computed:{exportTypeOptions:function(){return de},revenueOptions:function(){return ue},siteId:function(){return i["Matomo"].idSite}}});pe.render=ne;var me=pe;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */Object(i["createAngularJsAdapter"])({component:me,scope:{exportTypes:{angularJsBind:"="},alreadyCreatedExportTypes:{angularJsBind:"="},clickIdProviders:{angularJsBind:"="},hasWriteAccess:{angularJsBind:"="}},directiveName:"goalConversionExportEdit"})}})}));
//# sourceMappingURL=GoalConversionExport.umd.min.js.map